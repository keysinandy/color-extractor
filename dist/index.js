"use strict";var t=function(){function t(t,i){this.options=null!=i?i:{};var n=this.options,o=n.width,a=n.height;this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=t.naturalWidth,this.canvas.height=t.naturalHeight,this.width=null!=o?o:t.naturalWidth,this.height=null!=a?a:t.naturalHeight,this.context.drawImage(t,0,0,this.canvas.width,this.canvas.height)}return t.prototype.getImageData=function(){var t=this.options,i=t.offsetX,n=void 0===i?0:i,o=t.offsetY,a=void 0===o?0:o;return this.context.getImageData(n,a,this.width,this.height).data},t}(),i=function(){return i=Object.assign||function(t){for(var i,n=arguments,o=1,a=arguments.length;o<a;o++)for(var e in i=n[o])Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e]);return t},i.apply(this,arguments)},n=function(){function t(t,n){this.bitmap=t;this.options=i(i({},{quality:10,background:{r:255,g:255,b:255},allowWhite:!1}),n)}return t.prototype.getPalette=function(){var t=this.options,i=t.quality,n=t.background,o=t.allowWhite,a=function(t){for(var i=t.bitMap,n=t.quality,o=t.background,a=void 0===o?{r:255,g:255,b:255}:o,e=t.allowWhite,r=[],h=void 0,s=void 0,u=void 0,c=void 0,l=0;l<i.length;l+=4*n){if(h=i[l+0],s=i[l+1],u=i[l+2],(c=i[l+3])<255){var g=c/255;h=h*g+a.r*(1-g),s=s*g+a.g*(1-g),u=u*g+a.b*(1-g)}!e&&h>250&&s>250&&u>250||r.push([h,s,u])}return r}({bitMap:this.bitmap,background:n,quality:i,allowWhite:o});return function(t){for(var i=t.length,n=0,o={r:0,g:0,b:0},a=void 0,e=void 0,r=void 0,h=0;h<i;h+=1)a=t[h][0],e=t[h][1],r=t[h][2],o.r+=a,o.g+=e,o.b+=r,n++;return[~~(o.r/n),~~(o.g/n),~~(o.b/n)]}(a)},t}(),o=function(i,o){void 0===o&&(o={});var a=o.clip,e=o.palette,r=new t(i,a).getImageData();return new n(r,e).getPalette()};exports.getColor=o,exports.getColorByUrl=function(t,i){return void 0===i&&(i={}),new Promise((function(n,a){try{var e=document.createElement("img");e.src=t,e.crossOrigin="anonymous",e.onload=function(){n(o(e,i)),e.remove()}}catch(t){a(t)}}))};
